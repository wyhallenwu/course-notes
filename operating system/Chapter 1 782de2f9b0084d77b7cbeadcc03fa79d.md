# Chapter 1

Created: October 20, 2021 2:49 PM

# 操作系统引论

## 操作系统的定义

> OS是直接控制和管理计算机硬件，软件资源，合理地对各类作业进行调度，以方便用户使用的程序集合
> 

## 操作系统的目标和作用

### 操作系统的目标

1. 方便性
2. 有效性
    1. 提高资源的利用率
    2. 提高系统的吞吐量
3. 可扩充性
4. 开放性

### 操作系统的作用

1. 作为用户和计算机硬件系统之间的接口
    
    > 操作系统可以通过命令，系统调用和图标窗口方式来与操作系统通信
    > 
    > 
    > ![1.bmp](Chapter%201%20782de2f9b0084d77b7cbeadcc03fa79d/1.bmp)
    > 
2. 作为计算机系统资源的管理者
    
    > 四类资源：处理机，存储器，I/O设备，文件（数据和程序）
    > 
3. 实现了对计算资源的抽象

---

## 操作系统的发展过程

### 未配置操作系统的计算机系统

1. 人工操作方式
2. 脱机输入/输出 (off-line I/O) 

### 单道批处理系统

> 解决人机矛盾和IO设备与CPU速度不匹配
> 
1. 单道批处理系统的处理过程
    
    ![2.bmp](Chapter%201%20782de2f9b0084d77b7cbeadcc03fa79d/2.bmp)
    
2. 单道批处理系统的缺点
    
    资源的不到充分利用
    
    ![3.bmp](Chapter%201%20782de2f9b0084d77b7cbeadcc03fa79d/3.bmp)
    

### 多道批处理系统（操作系统开始出现）

用户提交的作业都放在**外存**上排成一个**后备队列**，由作业调度程序**按一定的算法**从后备队列中选择若干个作业**调入内存**，使他们共享cpu和系统的资源。

- 优点
    1. 并发执行，共享资源
    2. 资源利用率高
    3. 系统吞吐量大
- 缺点
    1. 平均周转时间长
    2. 无人机交互能力（用户提交后只能等待计算机处理完成，中间不能控制自己的作业执行）
- 需要解决的问题
    1. 处理机争用
    2. 内存分配和保护问题
    3. IO设备分配问题
    4. 文件的组织和管理
    5. 作业管理
    6. 用户和系统的接口

### 分时系统

> 以时间片为单位轮流为各个用户/作业服务，终端用户服务并且能及时对用户服务请求做出响应
> 

分时系统的引入

1. 人机交互
2. 共享主机

分时系统的关键问题

1. 及时接收
    
    > 多路卡（多个IO接口）
    > 
2. 及时处理
    1. 作业直接进入内存
    2. 采用轮转运行的方式（引入时间片）
- 分时系统的特征
    1. 多路性（宏观上同时，微观上轮流）
    2. 独立性
    3. 及时性
    4. 交互性

### 实时系统

> 实时系统指系统能及时响应外部事件的请求，在规定时间内完成能对该事件的处理，并控制所有实时任务协调一致的运行
> 

实时任务的类型

1. 周期性和非周期性实时任务
    
    > 截止时间：开始截止时间，完成截止时间
    > 
2. 硬实时和软实时任务
    
    > 是否必须满足截止时间的要求
    > 

特征

1. 快速响应时间
2. 有限的交互能力
3. 高可靠性

## 基本操作系统的比较

![Untitled](Chapter%201%20782de2f9b0084d77b7cbeadcc03fa79d/Untitled.png)

### 微机操作系统

1. 单用户单任务
2. 单用户多任务：Windows
3. 多用户多任务：UNIX，LINUX

---

## **操作系统的基本特征**

**并发和共享是操作系统最基本的特征**

### 并发（concurrence）

1. 并行与并发的区别
    
    > 并行是指多个事件在同一时间间隔内发生；并发是指宏观上多个程序同时运行，微观上这些程序分时交替运行
    > 
2. 引入进程
    
    > 进程是指系统中能独立运行并作为资源分配的基本单位，是由一组机器指令，数据和堆栈组成的能独立运行的活动实体
    > 

### 共享（sharing）

> 系统中的资源可供内存中多个并发的进程共同使用，**并发与共享互为存在条件**
> 
1. 互斥共享方式
2. 同时访问方式

### 虚拟(virtual)

1. 时分复用技术
    1. 虚拟处理机技术
    2. 虚拟设备技术
2. 空分复用技术
    
    > 利用存储器的空闲时间分区域存放和运行其他的多道程序，以此提高内存利用率
    > 
    
    虚拟存储技术：本质上实现内存的分时复用
    

### 异步（asychronism）

进程执行过程停停走走

---

## 操作系统的主要功能

1. **处理机管理功能**
    1. 进程控制
        
        > 作业创建进程，撤销已结束的进程，以及控制进程在程序运行过程中的状态转换
        > 
    2. 进程同步
        
        > 互斥和同步
        > 
    3. 进程通信
    4. 调度
        
        > 作业调度和进程调度
        > 
2. **存储器管理功能**
    1. 内存分配
    2. 内存保护
    3. 地址映射
    4. 内存扩充
3. **设备管理功能**
    1. 缓冲管理
    2. 设备分配
    3. 设备处理
4. **文件管理功能**
    1. 文件存储空间管理
    2. 目录管理
    3. 文件按的读写管理和保护
5. **用户接口**

## 操作系统和用户之间的接口

1. 用户接口
2. 程序接口

# 操作系统体系结构

## 传统操作系统设计

1. 无结构操作系统
2. 模块化操作系统
3. 分层操作系统

## 微内核OS结构

> 微内核并非一个完整的操作系统，只是将操作系统最基本的部分放入**微内核**，确保把操作系统的内核做的很小。
> 
> 1. 足够小的核
> 2. 基于客户服务器模式
> 3. 机制与策略分离
> 4. 采用面向对象技术

### 微内核的基本功能

1. 进程（线程）管理
    
    > 机制与策略分离
    > 
    > 
    > 机制：实现某一功能的具体执行机构
    > 
    > 策略：在机制基础上借助于某些参数和算法来实现该功能的优化
    > 
2. 低级存储器管理
    
    > 低级存储器管理机制，用户空间的逻辑地址转换为内存空间的物理地址
    > 
3. 中断和陷入处理

### 优缺点

- 优点
    1. 可扩展性
    2. 可靠性
    3. 可移植性
    4. 对分布式系统的支持
    5. 融入面向对象技术
- 缺点
    1. 运行效率降低
        
        > 上下文切换的次数增加
        > 

---

# 操作系统补充（内核态相关）

操作系统有内核态和用户态：

处于内核态可以执行特权指令和非特权指令，运行内核程序

处于用户态只能执行非特权指令，运行应用程序

CPU通过程序状态字寄存器PSW判断，1表示内核态，0表示用户态

状态切换

> 内核态→用户态：**执行特权指令修改PSW标志位**
> 
> 
> 用户态→内核态：**由中断引发，硬件自动完成转换过程，强行夺回CPU使用权**
> 

## 操作系统体系结构

- 大内核，单内核，宏内核
- 微内核

## 操作系统内核功能

1. 系统资源管理（操作系统的主要功能 4个）
2. 时钟管理
3. 中断处理
4. 原语（设备驱动，CPU切换）

## **层次结构**

![Untitled](Chapter%201%20782de2f9b0084d77b7cbeadcc03fa79d/Untitled%201.png)

大内核VS微内核

![Untitled](Chapter%201%20782de2f9b0084d77b7cbeadcc03fa79d/Untitled%202.png)

**微内核不一定比大内核快**

## 其他操作系统

Windows采用改进的微内核

Linux采用单内核机制

## 中断和异常

**中断的作用：使CPU由用户态转换为内核态，是操作系统夺回CPU的唯一途径**

- 中断类型
    1. 内中断
        
        > 与当前执行指令有关，来源于CPU内部。 **陷入指令：主动交还CPU使用权给内核  故障：错误条件内核可修复（缺页故障），终止：错误内核无法修复（整数除0，非法使用特权指令）**
        > 
        > 
        > CPU在执行指令时会检查是否由异常发生
        > 
    2. 外中断
        
        > 与当前指令无关，来源于CPU外部。 时钟中断，IO请求中断
        > 
        > 
        > 每个指令周期末尾，CPU检查是否有外中断信号需要处理
        > 

### 中断机制的基本原理

**不同的中断信号，需要不同的中断处理程序来处理，根据中断类型查询中断向量表，找到相应中断处理程序在内存中的位置，中断处理程序一定是内核程序，运行在内核态**

---

## OS接口

![Untitled](Chapter%201%20782de2f9b0084d77b7cbeadcc03fa79d/Untitled%203.png)

### 给用户用的

联机用户接口

> 命令+终端处理程序+命令解释程序
> 
> 
> 命令解释程序：UNIX shell
> 

脱机用户接口

> 适用于批处理系统
> 
> 
> JCL+作业说明书+命令解释程序
> 

### 给应用程序用的

程序接口（系统调用）

> 为用户程序访问系统资源而设置的一种可供应用程序调用的特殊函数，应用程序可以通过系统调用来请求获得操作系统内核的服务
> 

凡是与共享资源有关的操作都必须通过系统调用的方式向操作系统内核提出服务请求，由操作系统内核代为完成

### 系统调用的过程

1. 传递系统调用参数
2. 执行陷入指令（用户态）
3. 执行内核程序处理系统调用（核心态）
4. 返回